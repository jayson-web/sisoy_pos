{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jayso/pos_sisoy/app/%28dashboard%29/bookings/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport Link from \"next/link\"\r\nimport { storage, type Booking } from \"@/lib/storage\"\r\nimport { getApiBase } from \"@/lib/api\"\r\n\r\ntype FilterStatus = \"all\" | \"today\" | \"upcoming\" | \"completed\" | \"cancelled\"\r\n\r\ninterface ModalState {\r\n  isOpen: boolean\r\n  type: \"success\" | \"error\" | \"confirm\" | null\r\n  title: string\r\n  message: string\r\n  action?: () => void\r\n}\r\n\r\nexport default function BookingsPage() {\r\n  const [bookings, setBookings] = useState<Booking[]>([])\r\n  const [filter, setFilter] = useState<FilterStatus>(\"all\")\r\n  const [modal, setModal] = useState<ModalState>({\r\n    isOpen: false,\r\n    type: null,\r\n    title: \"\",\r\n    message: \"\",\r\n  })\r\n\r\n  useEffect(() => {\r\n    // Sync bookings from server on mount\r\n    const syncBookingsFromServer = async () => {\r\n      const apiBase = getApiBase()\r\n      try {\r\n        const resp = await fetch(`${apiBase}/bookings?action=list`)\r\n        if (resp.ok) {\r\n          const data = await resp.json()\r\n          // Handle both array and object with data property\r\n          const serverBookings = Array.isArray(data) ? data : (data?.data || [])\r\n          \r\n          if (serverBookings.length > 0) {\r\n            // Convert server bookings to client format\r\n            const clientBookings: Booking[] = serverBookings.map((b: any) => ({\r\n              id: String(b.id),\r\n              clientId: String(b.customer_id),\r\n              accommodationId: String(b.accommodation_id),\r\n              dateFrom: b.check_in,\r\n              dateTo: b.check_out,\r\n              status: b.status.toLowerCase() === 'confirmed' ? 'confirmed' : 'pending',\r\n              totalAmount: parseFloat(b.total_price) || 0,\r\n              createdAt: b.created_at || new Date().toISOString(),\r\n              paymentStatus: 'paid',\r\n              accommodation_name: b.accommodation_name,\r\n            }))\r\n            localStorage.setItem('pos_bookings', JSON.stringify(clientBookings))\r\n            setBookings(clientBookings)\r\n            return\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.error('Error syncing bookings from server:', e)\r\n        // fall back to local storage if server unavailable\r\n      }\r\n      // Fallback: read from localStorage\r\n      const allBookings = storage.getBookings()\r\n      setBookings(allBookings)\r\n    }\r\n    \r\n    syncBookingsFromServer()\r\n  }, [])\r\n\r\n  const getFilteredBookings = () => {\r\n    const today = new Date().toISOString().split(\"T\")[0]\r\n    const now = new Date()\r\n\r\n    return bookings.filter((b) => {\r\n      switch (filter) {\r\n        case \"today\":\r\n          return b.dateFrom === today\r\n        case \"upcoming\":\r\n          return new Date(b.dateFrom) > now && b.status !== \"cancelled\"\r\n        case \"completed\":\r\n          return b.status === \"completed\"\r\n        case \"cancelled\":\r\n          return b.status === \"cancelled\"\r\n        default:\r\n          return true\r\n      }\r\n    })\r\n  }\r\n\r\n  const handleDelete = async (id: string) => {\r\n    const apiBase = getApiBase()\r\n    try {\r\n      const resp = await fetch(`${apiBase}/bookings?id=${id}`, {\r\n        method: \"DELETE\",\r\n      })\r\n      \r\n      if (resp.ok) {\r\n        // Remove from local storage after successful DB deletion\r\n        storage.deleteBooking(id)\r\n        setBookings(storage.getBookings())\r\n        setModal({\r\n          isOpen: true,\r\n          type: \"success\",\r\n          title: \"Success\",\r\n          message: \"Booking deleted successfully\",\r\n        })\r\n      } else {\r\n        const errorData = await resp.json()\r\n        setModal({\r\n          isOpen: true,\r\n          type: \"error\",\r\n          title: \"Error\",\r\n          message: `Failed to delete booking: ${errorData.error || 'Unknown error'}`,\r\n        })\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error deleting booking:\", error)\r\n      setModal({\r\n        isOpen: true,\r\n        type: \"error\",\r\n        title: \"Error\",\r\n        message: \"Error deleting booking\",\r\n      })\r\n    }\r\n  }\r\n\r\n  const handleStatusChange = (id: string, newStatus: string) => {\r\n    storage.updateBooking(id, { status: newStatus as any })\r\n    setBookings(storage.getBookings())\r\n  }\r\n\r\n  const filteredBookings = getFilteredBookings()\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case \"confirmed\":\r\n        return \"bg-green-100 text-green\"\r\n      case \"pending\":\r\n        return \"bg-yellow-100 text-yellow-800\"\r\n      case \"completed\":\r\n        return \"bg-blue-100 text-blue-800\"\r\n      case \"cancelled\":\r\n        return \"bg-red-100 text-red\"\r\n      default:\r\n        return \"bg-gray-100 text-gray-800\"\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex justify-between items-center\">\r\n        <h1 className=\"text-3xl font-bold text-(--primary-blue)\">Bookings</h1>\r\n        <Link\r\n          href=\"/booking/new\"\r\n          className=\"px-4 py-2 bg-(--yellow) text-(--gray-dark) rounded font-bold hover:bg-yellow-400\"\r\n        >\r\n          New Booking\r\n        </Link>\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <div className=\"flex gap-2 bg-white p-4 rounded border border-(--gray-light)\">\r\n        {[\"all\", \"today\", \"upcoming\", \"completed\", \"cancelled\"].map((f) => (\r\n          <button\r\n            key={f}\r\n            onClick={() => setFilter(f as FilterStatus)}\r\n            className={`px-4 py-2 rounded font-bold capitalize text-sm transition-colors ${\r\n              filter === f ? \"bg-(--primary-blue) text-white\" : \"bg-(--gray-bg) text-(--gray-dark) hover:bg-gray-300\"\r\n            }`}\r\n          >\r\n            {f}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Table */}\r\n      <div className=\"bg-white border border-(--gray-light) rounded overflow-x-auto\">\r\n        <table className=\"w-full\">\r\n          <thead className=\"bg-(--gray-bg) border-b border-(--gray-light)\">\r\n            <tr>\r\n              <th className=\"text-left py-3 px-4 font-bold text-(--gray-dark)\">ID</th>\r\n              <th className=\"text-left py-3 px-4 font-bold text-(--gray-dark)\">Customer</th>\r\n              <th className=\"text-left py-3 px-4 font-bold text-(--gray-dark)\">Room</th>\r\n              <th className=\"text-left py-3 px-4 font-bold text-(--gray-dark)\">Dates</th>\r\n              <th className=\"text-left py-3 px-4 font-bold text-(--gray-dark)\">Amount</th>\r\n              <th className=\"text-left py-3 px-4 font-bold text-(--gray-dark)\">Status</th>\r\n              <th className=\"text-left py-3 px-4 font-bold text-(--gray-dark)\">Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {filteredBookings.map((b) => {\r\n              const client = storage.getClients().find((c) => c.id === b.clientId)\r\n              const room = storage.getAccommodations().find((a) => a.id === b.accommodationId)\r\n              return (\r\n                <tr key={b.id} className=\"border-b border-(--gray-light) hover:bg-(--gray-bg)\">\r\n                  <td className=\"py-3 px-4 text-sm font-mono\">{b.id.substring(0, 8)}</td>\r\n                  <td className=\"py-3 px-4 text-sm\">\r\n                    <div className=\"font-medium\">{(b as any).customerName || `${client?.firstName || ''} ${client?.lastName || ''}`.trim() || 'N/A'}</div>\r\n                    {((b as any).transactionId || (b as any).transaction_reference) && (\r\n                      <div className=\"text-xs text-gray-500 mt-1\">Txn: {(b as any).transactionId || (b as any).transaction_reference}</div>\r\n                    )}\r\n                  </td>\r\n                  <td className=\"py-3 px-4 text-sm\">{room?.name}</td>\r\n                  <td className=\"py-3 px-4 text-sm\">\r\n                    {b.dateFrom} to {b.dateTo}\r\n                  </td>\r\n                  <td className=\"py-3 px-4 text-sm font-bold\">â‚±{b.totalAmount.toLocaleString()}</td>\r\n                  <td className=\"py-3 px-4\">\r\n                    <span className={`px-2 py-1 rounded text-xs font-bold ${getStatusColor(b.status)}`}>\r\n                      {b.status}\r\n                    </span>\r\n                  </td>\r\n                  <td className=\"py-3 px-4 text-sm space-x-2\">\r\n                    <Link href={`/booking/${b.id}`} className=\"text-(--primary-blue) hover:underline\">\r\n                      View\r\n                    </Link>\r\n                    <button onClick={() => handleDelete(b.id)} className=\"text-red hover:underline\">\r\n                      Delete\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              )\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      {filteredBookings.length === 0 && (\r\n        <div className=\"text-center py-12 bg-(--gray-bg) rounded\">\r\n          <p className=\"text-(--gray-dark)\">No bookings found.</p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Modal */}\r\n      {modal.isOpen && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\r\n          <div className={`bg-white rounded-lg p-6 max-w-sm w-full shadow-lg border-l-4 ${\r\n            modal.type === \"success\" ? \"border-green-500\" : \"border-red-500\"\r\n          }`}>\r\n            <h2 className={`text-lg font-bold mb-2 ${\r\n              modal.type === \"success\" ? \"text-green-600\" : \"text-red-600\"\r\n            }`}>\r\n              {modal.title}\r\n            </h2>\r\n            <p className=\"text-gray-700 mb-6\">{modal.message}</p>\r\n            <button\r\n              onClick={() => setModal({ ...modal, isOpen: false })}\r\n              className=\"w-full py-2 bg-(--primary-blue) text-white rounded font-bold hover:bg-blue-900 transition-colors\"\r\n            >\r\n              Close\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}