{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jayso/pos_sisoy/lib/db.js"],"sourcesContent":["import mysql from 'mysql2/promise';\r\n\r\nlet pool = null;\r\n\r\nexport async function getConnection() {\r\n  if (!pool) {\r\n    pool = mysql.createPool({\r\n      host: process.env.DB_HOST || '127.0.0.1',\r\n      user: process.env.DB_USER || 'root',\r\n      password: process.env.DB_PASS || '',\r\n      database: process.env.DB_NAME || 'sisoy_booking',\r\n      port: parseInt(process.env.DB_PORT || '3306'),\r\n      waitForConnections: true,\r\n      connectionLimit: 10,\r\n      queueLimit: 0,\r\n    });\r\n  }\r\n  return pool;\r\n}\r\n\r\nexport async function query(sql, values = []) {\r\n  const pool = await getConnection();\r\n  const connection = await pool.getConnection();\r\n  try {\r\n    const [results] = await connection.execute(sql, values);\r\n    return results;\r\n  } finally {\r\n    connection.release();\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,IAAI,OAAO;AAEJ,eAAe;IACpB,IAAI,CAAC,MAAM;QACT,OAAO,8IAAK,CAAC,UAAU,CAAC;YACtB,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;YAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;YAC7B,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;YACjC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;YACjC,MAAM,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI;YACtC,oBAAoB;YACpB,iBAAiB;YACjB,YAAY;QACd;IACF;IACA,OAAO;AACT;AAEO,eAAe,MAAM,GAAG,EAAE,SAAS,EAAE;IAC1C,MAAM,OAAO,MAAM;IACnB,MAAM,aAAa,MAAM,KAAK,aAAa;IAC3C,IAAI;QACF,MAAM,CAAC,QAAQ,GAAG,MAAM,WAAW,OAAO,CAAC,KAAK;QAChD,OAAO;IACT,SAAU;QACR,WAAW,OAAO;IACpB;AACF"}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jayso/pos_sisoy/app/api/accommodations/route.js"],"sourcesContent":["import { query } from '@/lib/db.js';\r\n\r\nexport async function GET(request) {\r\n  try {\r\n    const searchParams = new URL(request.url).searchParams;\r\n    const action = searchParams.get('action');\r\n\r\n    if (action === 'list') {\r\n      const results = await query('SELECT * FROM accommodations WHERE status = \"active\" ORDER BY name ASC');\r\n      return Response.json({ data: results });\r\n    }\r\n\r\n    if (action === 'get') {\r\n      const id = searchParams.get('id');\r\n      const results = await query('SELECT * FROM accommodations WHERE id = ?', [parseInt(id || '0')]);\r\n\r\n      if (!results.length) {\r\n        return Response.json({ error: 'Not found' }, { status: 404 });\r\n      }\r\n\r\n      return Response.json(results[0]);\r\n    }\r\n\r\n    return Response.json({ error: 'Invalid action' }, { status: 400 });\r\n  } catch (error) {\r\n    console.error('Accommodation error:', error);\r\n    return Response.json({ error: 'Failed to fetch accommodations: ' + error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request) {\r\n  try {\r\n    const searchParams = new URL(request.url).searchParams;\r\n    const action = searchParams.get('action');\r\n\r\n    if (action === 'create') {\r\n      const body = await request.json();\r\n\r\n      const results = await query(\r\n        `INSERT INTO accommodations (name, type, capacity, price_per_night, description, status) \r\n         VALUES (?, ?, ?, ?, ?, 'active')`,\r\n        [\r\n          body.name || '',\r\n          body.type || 'Room',\r\n          parseInt(body.capacity || '2'),\r\n          parseFloat(body.price_per_night || '0'),\r\n          body.description || '',\r\n        ]\r\n      );\r\n\r\n      // Fetch the newly created accommodation\r\n      const newAccommodation = await query(\r\n        'SELECT * FROM accommodations WHERE id = ?',\r\n        [results.insertId]\r\n      );\r\n\r\n      return Response.json({ \r\n        success: true, \r\n        id: results.insertId,\r\n        ...newAccommodation[0] \r\n      });\r\n    }\r\n\r\n    return Response.json({ error: 'Invalid action' }, { status: 400 });\r\n  } catch (error) {\r\n    console.error('Accommodation create error:', error);\r\n    return Response.json({ error: 'Failed to create accommodation: ' + error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PATCH(request) {\r\n  try {\r\n    const searchParams = new URL(request.url).searchParams;\r\n    const id = searchParams.get('id');\r\n\r\n    if (!id) {\r\n      return Response.json({ error: 'id is required' }, { status: 400 });\r\n    }\r\n\r\n    const body = await request.json();\r\n    const updates = [];\r\n    const values = [];\r\n\r\n    // Build dynamic UPDATE statement\r\n    const allowedFields = ['name', 'type', 'capacity', 'price_per_night', 'description', 'status'];\r\n    for (const field of allowedFields) {\r\n      if (body[field] !== undefined && body[field] !== null) {\r\n        updates.push(`${field} = ?`);\r\n        values.push(field === 'capacity' || field === 'price_per_night' ? parseFloat(body[field]) : body[field]);\r\n      }\r\n    }\r\n\r\n    if (updates.length === 0) {\r\n      return Response.json({ error: 'No fields to update' }, { status: 400 });\r\n    }\r\n\r\n    values.push(parseInt(id));\r\n\r\n    await query(\r\n      `UPDATE accommodations SET ${updates.join(', ')} WHERE id = ?`,\r\n      values\r\n    );\r\n\r\n    // Fetch updated accommodation\r\n    const updated = await query(\r\n      'SELECT * FROM accommodations WHERE id = ?',\r\n      [parseInt(id)]\r\n    );\r\n\r\n    return Response.json({\r\n      success: true,\r\n      ...updated[0],\r\n    });\r\n  } catch (error) {\r\n    console.error('Accommodation update error:', error);\r\n    return Response.json({ error: 'Failed to update accommodation: ' + error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(request) {\r\n  try {\r\n    const searchParams = new URL(request.url).searchParams;\r\n    const id = searchParams.get('id');\r\n\r\n    if (!id) {\r\n      return Response.json({ error: 'id is required' }, { status: 400 });\r\n    }\r\n\r\n    const accommodationId = parseInt(id);\r\n\r\n    // Fetch accommodation before deleting\r\n    const existing = await query(\r\n      'SELECT * FROM accommodations WHERE id = ?',\r\n      [accommodationId]\r\n    );\r\n\r\n    if (!existing || existing.length === 0) {\r\n      return Response.json({ error: 'Accommodation not found' }, { status: 404 });\r\n    }\r\n\r\n    // Check if accommodation has active bookings\r\n    const activeBookings = await query(\r\n      'SELECT COUNT(*) as count FROM bookings WHERE accommodation_id = ? AND status IN (\"pending\", \"confirmed\")',\r\n      [accommodationId]\r\n    );\r\n\r\n    if (activeBookings[0].count > 0) {\r\n      return Response.json({ \r\n        error: `Cannot delete accommodation with active bookings (${activeBookings[0].count} found)` \r\n      }, { status: 409 });\r\n    }\r\n\r\n    // Soft delete by setting status to inactive\r\n    await query('UPDATE accommodations SET status = ? WHERE id = ?', ['inactive', accommodationId]);\r\n\r\n    return Response.json({\r\n      success: true,\r\n      message: `Accommodation ${accommodationId} deleted successfully`,\r\n      deleted_id: accommodationId,\r\n    });\r\n  } catch (error) {\r\n    console.error('Accommodation delete error:', error);\r\n    return Response.json({ error: 'Failed to delete accommodation: ' + error.message }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}